services:
  backend:
    build: .
    restart: unless-stopped
    depends_on:
      - postgres
    ports:
      - 8001:8001
    environment:
      - POSTGRES.PASSWORD
      - POSTGRES.HOST
      - POSTGRES.PORT
      - SESSION.SECRET
      - RABBIT.PASSWORD


  postgres:
    image: postgres:16.2-alpine
    restart: unless-stopped
    shm_size: 128mb
    environment:
      POSTGRES_USER: try-on-admin
      POSTGRES_DB: try-on
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
    secrets:
      - postgres_password

secrets:
  postgres_password:
      environment: "POSTGRES.PASSWORD"

networks:
  default:
      external: true
      name: shared-api-network
